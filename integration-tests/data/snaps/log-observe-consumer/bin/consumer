#!/usr/bin/env python3

import subprocess
import sys
from http.server import BaseHTTPRequestHandler, HTTPServer

ERROR_MSG = "error controlling firewall"

def get_message():
  try:
    subprocess.check_output("tail -n 10 /var/log/syslog", shell=True)
    message = "ok\n"
  except Exception as e:
    message = "error accessing log\n"

  return message

class testRequestHandler(BaseHTTPRequestHandler):
  def do_GET(self):
    self.send_response(200)

    self.send_header('Content-type','text/html')
    self.end_headers()

    message = get_message()

    self.wfile.write(bytes('<!doctype html>'+message, "utf8"))
    return

def run():
  server_address = ('', 8081)
  httpd = HTTPServer(server_address, testRequestHandler)
  httpd.serve_forever()

if __name__ == '__main__':
  sys.exit(run())
