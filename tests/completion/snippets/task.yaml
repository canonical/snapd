summary: indirect completion

environment:
    SNAP_DIR: "${TESTSLIB}/snaps/test-snapd-complexion"

prepare: |
    . $TESTSLIB/snaps.sh
    install_local test-snapd-complexion

    mv "${SNAP_DIR}/test-snapd-complexion.bash-completer" "${SNAP_DIR}/test-snapd-complexion.bash-completer.orig"
    cp "${SPREAD_PATH}/${SPREAD_SUITE}/${SPREAD_VARIANT}.complete" "${SNAP_DIR}/test-snapd-complexion.bash-completer"

restore: |
    mv "${SNAP_DIR}/test-snapd-complexion.bash-completer.orig" "${SNAP_DIR}/test-snapd-complexion.bash-completer"
    snap remove test-snapd-complexion

execute: |
  d="$PWD"
  source "${SPREAD_PATH}/${SPREAD_SUITE}/${SPREAD_VARIANT}.vars"
  export _OUT0 _OUT1 _OUT2 _KEY1 _KEY2 _COMP
  sudo PATH=$PATH -E -u test expect -d -f "$d"/task.exp
