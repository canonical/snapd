summary: Check seccomp profile generation for apps and hooks.
prepare: |
  for snap in basic-binaries basic-hooks
  do
    snapbuild ./../fixtures/snaps/$snap .
  done
restore: |
  for snap in basic-binaries basic-hooks
  do
    sudo snap remove $snap
    rm ./${snap}_1.0_all.snap
  done
execute: |
  seccomp_profile_directory="/var/lib/snapd/seccomp/profiles"

  echo "seccomp profiles are generated for apps"
  sudo snap install ./basic-binaries_1.0_all.snap

  for profile in snap.basic-binaries.block snap.basic-binaries.cat snap.basic-binaries.echo snap.basic-binaries.fail snap.basic-binaries.success
  do
    [ -f "$seccomp_profile_directory/$profile" ] || exit 1
  done

  echo "seccomp profiles are generated for hooks"
  sudo snap install ./basic-hooks_1.0_all.snap

  for profile in snap.basic-hooks.hook.install snap.basic-hooks.hook.upgrade
  do
    [ -f "$seccomp_profile_directory/$profile" ] || exit 1
  done
