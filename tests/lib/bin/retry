#!/bin/bash

MAX_ATTEMPTS=20
SLEEP_TIME=.5
for i in "$@"; do
    case $i in
        --max-attempts)
        MAX_ATTEMPTS="$2"
        shift 2
        ;;
        --sleep-time)
        SLEEP_TIME="$2"
        shift 2
        ;;
    esac
done

COMMAND="$1"
shift

if [ -z "$COMMAND" ]; then
    echo "ERROR: No command provided"
    exit 1
fi

for _ in $(seq "$MAX_ATTEMPTS"); do
    if "$COMMAND" "$@"; then
        exit 0
    fi

    sleep "$SLEEP_TIME"
done
exit 1
