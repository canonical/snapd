name: test-snapd-daemon-desktop
version: "1"
summary: test-snapd-daemon-user-in-graphical-desktop
description: |
 Test the snap_daemon user in graphical desktop
confinement: strict
grade: devel
base: core24

apps:
  test-snapd-daemon-user-in-graphical-desktop:
    command: usr/bin/ls
    plugs:
      - desktop
    daemon: simple
    passthrough: #///! TODO: Remove once daemon-scope lands in snapcraft
      daemon-scope: user
    restart-condition: on-success
    restart-delay: 2s

  test-snapd-daemon-user-in-graphical-desktop-dbus:
    command: usr/bin/ls
    plugs:
      - wayland
    daemon: dbus
    passthrough: #///! TODO: Remove once daemon-scope lands in snapcraft
      daemon-scope: user
    restart-condition: on-success
    restart-delay: 2s

  test-snapd-daemon-user-in-graphical-desktop-dbus2:
    command: usr/bin/ls
    plugs:
      - x11
      - network-bind
    daemon: simple
    passthrough: #///! TODO: Remove once daemon-scope lands in snapcraft
      daemon-scope: user
    restart-condition: on-success
    restart-delay: 2s
    sockets:
      mysocket:
        listen-stream: $XDG_RUNTIME_DIR/mysocket-0
        socket-mode: 0644

  test-snapd-daemon-user-normal:
    command: usr/bin/ls
    daemon: simple
    passthrough: #///! TODO: Remove once daemon-scope lands in snapcraft
      daemon-scope: user
    restart-condition: on-success
    restart-delay: 2s

parts:
  test-snapd-daemon-user-in-graphical-desktop:
    plugin: nil
    stage-packages:
    - coreutils

