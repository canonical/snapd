summary: Smoke test for tests.pkgs tool

execute: |
    if os.query is-core; then
        tests.pkgs -h 2>&1 | MATCH 'tests.pkgs: Ubuntu Core is not supported'
        exit
    fi

    # pkgs tool presents the usage screen when invoked without arguments
    # or with the -h or --help options.
    tests.pkgs | MATCH 'usage: tests.pkgs {install,remove} \[PACKAGE...\]'
    tests.pkgs -h | MATCH 'usage: tests.pkgs {install,remove} \[PACKAGE...\]'
    tests.pkgs --help | MATCH 'usage: tests.pkgs {install,remove} \[PACKAGE...\]'

    # Check the test pkg is not installed
    not tests.pkgs is-installed test-snapd-pkg-1

    # Install the test pkg and check it is installed and query it
    tests.pkgs install test-snapd-pkg-1
    tests.pkgs query test-snapd-pkg-1
    tests.pkgs is-installed test-snapd-pkg-1

    # Remove the test pkg and check it is not installed anymore and query it
    tests.pkgs remove test-snapd-pkg-1
    tests.pkgs query test-snapd-pkg-1
    not tests.pkgs is-installed test-snapd-pkg-1

    # Install 2 test pkgs and check they are is installed
    tests.pkgs install test-snapd-pkg-1 test-snapd-pkg-2
    tests.pkgs is-installed test-snapd-pkg-1
    tests.pkgs is-installed test-snapd-pkg-2

    # Remove 2 test pkgs and check they are is not installed anymore
    tests.pkgs remove test-snapd-pkg-1 test-snapd-pkg-2
    not tests.pkgs is-installed test-snapd-pkg-1
    not tests.pkgs is-installed test-snapd-pkg-2

    # Check the message when a command is not supported
    tests.pkgs noexist test-snapd-pkg-1 2>&1 | MATCH 'tests.pkgs: unknown command noexist'
    tests.pkgs -install test-snapd-pkg-1 2>&1 | MATCH 'tests.pkgs: unknown option -install'

