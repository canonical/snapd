# SPDX-License-Identifier: Apache-2.0
# SPDX-FileCopyrightText: Zygmunt Krynicki
name: plz-run
base: bare
build-base: core24
summary: A sandbox escape that convenient for testing
description: |
    Snap applications run in a sandbox that largely prevents one from starting
    arbitrary applications. This is useful in general but poses a problem for
    a class of software that's designed to mostly do exactly that: desktop shells,
    build systems, test software and other generalized execution directors.

    The plz-run program uses Systemd APIs to start a process in a new execution
    environment, unrelated to the environment of the caller. This allows
    escaping the sandbox and starting arbitrary programs.

license: Apache-2.0
confinement: strict
version: 0.2

apps:
    plz-run:
        command: bin/plz-run
        plugs:
            - checkbox-support
        environment:
            # https://github.com/canonical/bare-base/issues/2
            DBUS_SYSTEM_BUS_ADDRESS: unix:path=/run/dbus/system_bus_socket
parts:
    plz-run:
        plugin: go
        build-snaps:
        - go
        build-environment:
        - CGO_ENABLED: 0
        source: .
