summary: Ensure we have unpacked kernel.img/initrd.img on uboot systems

systems: [ubuntu-core-*-arm-*]

environment:
    NAME/initrdimg: initrd.img
    NAME/kernelimg: kernel.img

execute: |
    if os.query is-core20; then
        echo "Check that on UC20, the kernel snap is extracted onto ubuntu-seed, not on ubuntu-boot"
        output=$(find /run/mnt/ubuntu-seed/systems/*/kernel/ -name "$NAME" )
        if [ -z "$output" ]; then
            echo "Not found expected file $NAME in /run/mnt/ubuntu-seed/systems/*/kernel/"
            exit 1
        fi
    else
        echo "Check that on non UC20, the kernel snap is extracted onto /boot/uboot"
        output=$(find /boot/uboot/*-kernel_*.snap/ -name "$NAME" )
        if [ -z "$output" ]; then
            echo "Not found expected file $NAME in /boot/uboot/*-kernel_*.snap/"
            exit 1
        fi
    fi
