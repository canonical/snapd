summary: Check that snaps vanishing are handled gracefully
restore: |
  rm -rf $TRYDIR
execute: |
  TRYDIR="$(mktemp -d)"
  export TRYDIR
  cp -ar  $TESTSLIB/snaps/basic-binaries/* $TRYDIR

  echo Trying a snap
  snap try $TRYDIR
  snap list |grep basic

  echo Removing a snap try dir does not break everything
  rm -rf $TRYDIR
  snap list |grep core

  echo A snap in broken state can be removed
  snap remove basic-binaries

  echo Ensure that the symlink to the snapdir is gone
  test -h /var/lib/snapd/snaps/basic-binaries_x1.snap && exit 1