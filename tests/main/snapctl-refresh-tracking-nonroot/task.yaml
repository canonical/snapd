summary: Check that `snapctl refresh` works with the tracking flag for a non-root user

details: |
    Verifies the `snapctl` command can be used in a non-privileged context
    and returns the channel being tracked when passed the --tracking flag.

prepare: |
    tests.session prepare -u test
    "$TESTSTOOLS"/snaps-state install-local test-snapd-sh-core24
    snap switch test-snapd-sh-core24 --channel latest/stable

restore: |
    snap remove --purge test-snapd-sh-core24
    tests.session restore -u test

execute: |
    ...
    tests.session exec -u test sh -c 'test-snapd-sh-core24.sh -c \'snapctl refresh --tracking\'' > user-tracking.log
    MATCH '^latest/stable$' < user-tracking.log
    not tests.session exec -u test sh -c 'test-snapd-sh-core24.sh -c \'snapctl refresh --pending\'' > user-err-tracking.log
    MATCH '^non-root user only supports --tracking' < user-err-tracking.log
