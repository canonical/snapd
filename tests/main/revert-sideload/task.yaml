summary: Checks for snap sideload reverts

# Disabled for Fedora until test case is properly ported
systems: [-fedora-*]

prepare: |
    snapbuild $TESTSLIB/snaps/basic .

restore: |
    rm ./basic_1.0_all.snap

execute: |
    echo Installing sideloaded snap
    snap install --dangerous ./basic_1.0_all.snap
    snap list | MATCH "x1"

    echo Installing new version of sideloaded snap
    snap install --dangerous ./basic_1.0_all.snap
    snap list | MATCH "x2"

    echo Reverting to the previous version
    snap revert basic | MATCH reverted
    snap list | MATCH "x1"
