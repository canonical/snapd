summary: Checks for snap login

systems: [-ubuntu-core-16-64, -ubuntu-core-16-arm-64, -ubuntu-core-16-arm-32]

restore: |
    snap logout || true

execute: |
    echo "Checking missing email error"
    expect -f missing_email_error.exp

    echo "Checking wrong password error"
    expect -f unsuccessful_login.exp

    if output=$(snap managed); then
        echo "Without login managed should exit 1. Output:"
        echo $output
    fi
    if [ "$output" != "system is not managed" ]; then
        echo "Unexpected output from 'snap managed':"
        echo $output
    fi

    if [[ $SPREAD_STORE_USER && $SPREAD_STORE_PASSWORD ]]; then
        echo "Checking successful login"
        expect -f successful_login.exp

        output=$(snap managed)
        if [ "$output" != "system is managed" ]; then
            echo "Unexpected output from 'snap managed':"
            echo $output
            exit 1
        fi

        snap logout
    fi

