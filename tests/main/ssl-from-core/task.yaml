summary: Verify /etc/ssl comes always from the core snap and not the host system
systems:
    # This test only applies to classic systems
    - -ubuntu-core-16-*
prepare: |
    echo "Having installed the test snap"
    . $TESTSLIB/snaps.sh
    install_local test-snapd-tools
execute: |
    echo "We can check the inode number of /etc/ssl"
    host_inode="$(stat -c '%i' /etc/ssl)"
    if [ -e /snap/core/current ]; then
        core_inode="$(stat -c '%i' /snap/core/current/etc/ssl)"
    else
        core_inode="$(stat -c '%i' /snap/ubuntu-core/current/etc/ssl)"
    fi
    effective_inode="$(test-snapd-tools.cmd stat -c '%i' /etc/ssl)"
    echo "The inode number as seen from a confined snap should be that of the /etc/ssl from the core snap"
    [ "$host_inode" != "$core_inode" ]
    [ "$effective_inode" = "$core_inode" ]
