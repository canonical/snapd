summary: Check change abort

systems: [-ubuntu-core-16-64]

environment:
    SNAP_NAME: test-snapd-tools

execute: |
    echo "Abort with invalid id"
    if snap abort 10000000; then
        echo "abort with invalid id should fail"
        exit 1
    fi

    echo "===================================="

    echo "Abort with valid id - error"
    subdirPath="/snap/$SNAP_NAME/current/foo"
    mkdir -p $subdirPath
    . $TESTSLIB/snaps.sh
    if install_local $SNAP_NAME; then
        echo "install should fail when the target directory exists"
        exit 1
    fi
    if snap abort 1; then
        echo "abort with valid failed id should fail"
        exit 1
    fi
    rm -rf $subdirPath

    echo "===================================="

    echo "Abort with valid id - done"
    install_local $SNAP_NAME
    if snap abort 2; then
        echo "abort with valid done id should fail"
        exit 1
    fi
