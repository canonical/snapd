summary: Ensure systemd environment generator works

# systemd environment generators are only supported on 17.10+
systems: [ubuntu-18.04-*]

execute: |
    # FIXME: we can avoid the reboot once issue:
    #   https://github.com/systemd/systemd/issues/9972
    # is fixed
    echo "Ensure to reboot at least once"
    if [ "$SPREAD_REBOOT" = 0 ]; then
        REBOOT
    fi

    echo "Ensure PATH is correct in systemd system units"
    systemd-run --unit testenv env
    journalctl -u testenv | MATCH 'PATH=.*:/snap/bin.*'
