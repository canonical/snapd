summary: Check that `snap auto-import` works as expected

systems: [ubuntu-core-16-64,ubuntu-core-16-arm-32,ubuntu-core-16-arm-64]

prepare: |
    echo "Ensure the developer1.account is not already added"
    snap known account-key | grep -v "account-id: testrootorg"
    echo "Create a ramdisk with the developer1.account assertion"
    mkfs.vfat /dev/ram0
    mount /dev/ram0 /mnt
    cp $TESTSLIB/assertions/testrootorg-store.account-key /mnt/auto-import.assert

restore: |
    umount /mnt

execute: |
    echo "`snap auto-import` imports assertions from the mounted ramdisk"
    snap auto-import
    snap known account-key | grep "account-id: testrootorg"
