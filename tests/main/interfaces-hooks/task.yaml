summary: Check that `snap connect` runs interface hook

prepare: |
    echo "Build test hooks package"
    snap pack $TESTSLIB/snaps/basic-iface-hooks-consumer
    snap pack $TESTSLIB/snaps/basic-iface-hooks-producer
    snap install --dangerous basic-iface-hooks-consumer_1.0_all.snap
    snap install --dangerous basic-iface-hooks-producer_1.0_all.snap

restore: |
    rm -f basic-iface-hooks-consumer_1.0_all.snap
    rm -f basic-iface-hooks-producer_1.0_all.snap
    rm -f "$CONSUMER_DATA/prepare-plug-consumer-done"
    rm -f "$PRODUCER_DATA/prepare-slot-producer-done"
    rm -f "$CONSUMER_DATA/connect-plug-consumer-done"
    rm -f "$PRODUCER_DATA/connect-slot-producer-done"

environment:
    CONSUMER_DATA: /var/snap/basic-iface-hooks-consumer/common
    PRODUCER_DATA: /var/snap/basic-iface-hooks-producer/common

execute: |
    echo "Test that snap connect with plug and slot hooks succeeds"

    snap connect basic-iface-hooks-consumer:consumer basic-iface-hooks-producer:producer

    echo "Ensure the hooks were actually executed"
    [ -f "$CONSUMER_DATA/prepare-plug-consumer-done" ]
    [ -f "$PRODUCER_DATA/prepare-slot-producer-done" ]
    [ -f "$CONSUMER_DATA/connect-plug-consumer-done" ]
    [ -f "$PRODUCER_DATA/connect-slot-producer-done" ]
