summary: Test dbus activated snaps

execute: |
    echo "Ensure we have a snap that is dbus service activated"

    # FIXME: currently needs "--devmode" because of:
    # ???
    # without --devmode the dbus-daemon will hang in:
    # [pid ????] execve("/snap/test-snapd-dbus-service/x10/command-test-snapd-dbus-service.wrapper", ["/snap/test-snapd-dbus-service/x10/command-test-snapd-dbus-service.wrapper"], [/* 74 vars */] <unfinished ...>

    snap install --devmode test-snapd-dbus-service
    if ps afx|grep test-snapd-dbus-service; then
        echo "test-snapd-dbus-service already running! test broken"
        exit 1
    fi

    echo "Then sending methods to it will wake it up"
    dbus-send --print-reply --dest=io.snapcraft.SnapDbusService  / io.snapcraft.ExampleInterface.ExampleMethod | MATCH hello
