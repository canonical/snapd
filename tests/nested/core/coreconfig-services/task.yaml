summary: Disable and enable back core services via snap set with reboot.

systems: [ubuntu-18.04-64, ubuntu-20.04-64]

execute: |
  for srv in systemd-resolved systemd-timesyncd; do
      tests.nested exec "systemctl status ${srv}.service" | MATCH "Active: +active"

      echo "Disabling ${srv} service"
      tests.nested exec "sudo snap set system service.${srv}.disable=true"
      tests.nested exec "systemctl status ${srv}.service" | MATCH "Active: +inactive"
  done

  current_boot_id=$(tests.nested boot-id)
  tests.nested exec "sudo reboot" || true
  tests.nested wait-for reboot "$current_boot_id"

  for srv in systemd-resolved systemd-timesyncd; do
      echo "Enabling ${srv} service back"
      tests.nested exec "systemctl status ${srv}.service" | MATCH "Active: +inactive"
      tests.nested exec "sudo snap set system service.${srv}.disable=false"
      tests.nested exec "systemctl status ${srv}.service" | MATCH "Active: +active"
  done
