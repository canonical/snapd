summary: Check that bootstrap works for grub-systems
environment:
  UNPACKDIR: /tmp/gadget-unpack-dir
restore:
  rm -rf $UNPACKDIR
execute: |
 echo Creating $UNPACKDIR
 mkdir $UNPACKDIR
 echo Preparing bootstrap.yaml 
 cat > bootstrap.yaml <<EOF
 bootstrap:
   gadget-unpack-dir: $UNPACKDIR
   channel: edge
   model-assertion: model.assertion
 EOF

 echo Creating model assertion
 cat > model.assertion <<EOF
 type: model
 series: 16
 authority-id: my-brand
 brand-id: my-brand
 model: my-model
 class: my-class
 allowed-modes:  
 required-snaps:  
 architecture: amd64
 store: canonical
 gadget: canonical-pc
 kernel: canonical-pc-linux
 core: ubuntu-core
 timestamp: 2016-01-02T10:00:00-05:00
 body-length: 0

 openpgpg 2cln
 EOF

 echo Running bootstrap to fetch gadget
 sudo snap bootstrap bootstrap.yaml

 echo Verifying the result
 ls -lR $UNPACKDIR
 ls $UNPACKDIR/canonical-pc_*.snap
 ls $UNPACKDIR/canonical-pc_*.snap.sideinfo
 ls $UNPACKDIR/meta/snap.yaml
 ls $UNPACKDIR/grub.cfg
