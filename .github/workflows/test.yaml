name: Tests
on:
  pull_request:
    branches: [ "master", "release/**" ]
  push:
    branches: [ "release/**" ]

jobs:

  spread-cat:
    runs-on: self-hosted
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
      with:
        # spread uses tags as delta reference
        fetch-depth: 0
    - name: Run spread tests
      run: |
          # Register a problem matcher to highlight spread failures
          SPREAD_EXTERNAL_ADDRESS=10.48.54.1 spread external:ubuntu-core-20-64:tests/
