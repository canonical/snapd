#!/bin/bash

set -e

need_rebuild=0

if [ -d built-snap ]; then
    echo "-- $(date) -- prebuilt snap directory found"
else
    need_rebuild=1
fi

if [ "$FORCE_REBUILD" = "1" ]; then
    echo "-- $(date) -- force snapd snap rebuild"
    need_rebuild=1
fi

if [ "$need_rebuild" = 1 ]; then
    echo "-- $(date) -- rebuilding snapd snap"
    ./tests/build-test-snapd-snap
    echo "-- $(date) -- snapd snap rebuild complete"
fi

# Run spread
SPREAD_USE_PREBUILT_SNAPD_SNAP=true spread "$@"
